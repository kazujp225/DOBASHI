# フィードバック対応 修正内容まとめ

作成日: 2026-01-13
最終更新: 2026-01-13

---

## 1. 社長マスタの修正

### 現状の問題
- 説明フィールドが不要なのに存在している
- 虎カテゴリー（レギュラー虎など）が不要
- 社長登録時に別名（エイリアス）が入力できない
- 本名が1つのフィールド（苗字と名前を分けたい）
- 一覧にタグが表示されていない

### 要求される項目
| 項目 | 説明 |
|------|------|
| 本名（漢字）| 苗字と名前を**分ける** |
| 本名（カタカナ）| 苗字と名前を**分ける**（ひらがなでも分析ヒットするように）|
| 表示名 | 例: ドバシー社長 |
| その他の呼び名 | カンマ区切り or テキストボックス10個くらい |

### 例
```
本名(漢字): 土橋 / 和貴
本名(カタカナ): ドバシ / カズキ
表示名: ドバシー社長
その他の呼び名: ドバシー, ミダシー, ...
```

### 備考
- 「どばし」「どばしー」「みだしー」はあえて登録しなくても、カタカナ⇔ひらがなでどちらか登録してたら分析でヒットするようにしたい

### 修正対象ファイル
- [ ] `models/models.py` - Tigerクラスのフィールド修正（バックエンド側は未対応）
- [x] `frontend/src/components/TigerForm.tsx` - フォームに別名入力追加 ✅ **修正済み**
- [ ] `api/routers/tigers.py` - API修正
- [x] `frontend/src/pages/Tigers.tsx` - 一覧表示からdescription削除、タグ表示追加 ✅ **修正済み**
- [ ] `data/tigers.json` - データ構造変更

### 修正済み内容 (2026-01-13)
- ✅ 一覧画面: 説明列を削除し、別名タグ表示に変更
- ✅ 一覧画面: カテゴリセクション（レギュラー虎/準レギュラー虎/その他）を削除、シンプルな一覧に
- ✅ 登録フォーム: 説明入力欄を「その他の呼び名」入力フォームに変更
- ✅ 登録フォーム: 本名を苗字/名前（漢字・カタカナ）の4フィールドに分割
- ✅ 登録フォーム: 別名をタイプ選択付きで複数登録可能に

---

## 2. 言及判定の精度問題

### 現状の問題
- 野口さんに言及してないのにコメントが拾われている（誤検知）
- 正確じゃなさそうという指摘

### 原因（推定）
`analyzers/comment_analyzer.py` の言及判定ロジック:
```python
# 単純な部分文字列マッチング
if alias in normalized_text:
```

- 「野口」が別の文脈（野口英世、野口五郎、地名など）で使われても検出される
- 短い苗字だけでのマッチングが誤検知を起こしやすい

### 修正方針
1. 短い名前（2-3文字）の場合は「〜社長」「〜さん」などの敬称が後続しているかチェック
2. 出演虎5人を指定した場合、その5人のみで分析する（現状は全社長で分析）
3. カタカナ⇔ひらがな自動変換機能の追加

### 修正対象ファイル
- [x] `analyzers/comment_analyzer.py` - マッチングロジック強化 ✅ **修正済み**
- [ ] `data/aliases.json` - priority調整やtype見直し

### 修正済み内容 (2026-01-13)
- ✅ 境界チェック付きマッチング実装（`_is_word_boundary()`）
- ✅ 短いエイリアス（3文字以下）は敬称（社長/さん/氏など）が必要
- ✅ 4文字以上のエイリアスは境界チェック緩和（誤検知リスク低い）
- ✅ 勝者決定ロジック実装: 最長一致 → priority → type優先度
- ✅ `target_tigers`パラメータで出演虎のみ分析可能に

---

## 3. データ収集の改善

### 現状の問題
- URLは1行しか入力できない
- 収集後に手動で分析を実行する必要がある

### 要求
- 複数行でURLを書けるようにして、まとめて収集
- データ収集をしたら自動で分析までやってほしい

### 修正対象ファイル
- [ ] `frontend/src/pages/Collection.tsx` - 複数URL入力対応
- [ ] `api/routers/analysis.py` または収集API - 収集後自動分析

---

## 4. 動画分析の改善

### 現状の問題
- 動画毎の集計で、出演していない虎も表示される
- 虎5人を指定しないときちんと収集できていない
- 一覧が2列表示になっている

### 要求
- 動画毎の集計は出演している虎のみでOK（他の虎は出さない）
- コメント全体に対しての言及%がメインでいい
- 一覧は2列にせずに、1行で1動画で、総コメント数・出演虎とその割合を表示

### 修正対象ファイル
- [ ] `frontend/src/pages/Analysis.tsx` - レイアウト変更、出演虎のみ表示

---

## 5. CSVエクスポートの改善

### 現状の問題
現在のCSVは集計結果（順位、社長名、言及数、Rate_total、Rate_entity）

### 要求
- 集計結果ではなく**ローデータ**が欲しい
- 各動画毎の：
  - 総コメント数
  - 社長別のコメント数
  - 社長別の率（%）

### 修正対象ファイル
- [ ] `frontend/src/utils/csv.ts` - 新しいエクスポート形式追加
- [ ] `frontend/src/pages/Analysis.tsx` - エクスポート処理変更

---

## 6. 不要な機能・項目の削除

### 削除対象
- 社長マスタの「説明」フィールド
- 社長マスタの「カテゴリー」（レギュラー虎、準レギュラー虎など）
- 司会の登録（本家虎、それ以外でカテゴライズする必要もない）

### 修正済み内容 (2026-01-13)
- ✅ 一覧画面から説明列を削除
- ✅ 一覧画面からカテゴリセクションを削除
- ✅ 登録フォームから説明入力欄を削除

---

## 優先度

| 優先度 | 項目 | 理由 | 状態 |
|--------|------|------|------|
| 高 | 言及判定の精度問題 | 分析結果が正確でないと意味がない | ✅ 修正済み |
| 高 | 社長マスタの改修（別名登録） | 精度向上に直結 | ✅ 修正済み |
| 中 | 動画分析の出演虎のみ表示 | ユーザビリティ | 未着手 |
| 中 | CSVエクスポートのローデータ対応 | データ活用 | 未着手 |
| 中 | 複数URL一括収集 | 効率化 | 未着手 |
| 低 | description/category削除 | 表示の整理 | ✅ 修正済み |
| 低 | 本名の苗字/名前分割 | データ構造の整理 | ✅ UI修正済み |

---

## 進捗管理

- [x] 1. 社長マスタの修正（UI部分） ✅
- [x] 2. 言及判定の精度改善 ✅
- [ ] 3. データ収集の改善
- [ ] 4. 動画分析の改善
- [ ] 5. CSVエクスポートの改善
- [x] 6. 不要項目の削除 ✅
