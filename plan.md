# 令和の虎 社長別コメント言及分析システム 要件定義書

**バージョン**: 2.0
**最終更新日**: 2025-11-13
**ステータス**: レビュー中

---

## 1. プロジェクト概要

### 1.1 システム名称
令和の虎 社長別コメント言及分析システム

### 1.2 目的
YouTube番組「令和の虎」の各回において、出演している社長（原則5名）に対して、視聴者のコメント欄でどの社長がどれくらい言及されているかを定量的に可視化する。

**実現すること:**
- 社長ごとの「話題性」や「視聴者からの注目度」を定量把握
- 動画・企画ごとの反応傾向の比較
- 将来的なインフルエンサー/出演者分析プロダクトへの展開基盤構築

### 1.3 対象範囲
- **対象チャンネル**: YouTube「令和の虎」公式チャンネル
- **対象動画**: 本編動画（原則、毎回5名の社長が出演する回）
- **対象コメント**: 動画ごとのYouTubeコメント（トップレベルコメント）
- **対象期間**: 設定可能（例：直近○ヶ月／任意の日付範囲）

### 1.4 想定ユーザー
- **管理者**: データ収集・分析の実行者
- **データアナリスト**: 集計結果の閲覧・分析
- **番組制作関係者**: 視聴者反応の把握
- **マーケティング担当者**: 出演者の人気度分析

### 1.5 成功基準（KPI）
- **システム精度**: 社長言及判定の Precision ≥ 90%、Recall ≥ 80%
- **システム稼働**: データ収集〜集計完了まで、10動画あたり30分以内
- **ビジネス価値**: 月次レポート作成時間を手動集計比で80%削減

---

## 2. 用語定義

### 2.1 社長（虎）
番組に出演する投資家・社長。システム内では「社長マスタ」で一元管理する。
- 一意なID（tiger_id）
- 表示名（例：林社長）
- 本名／フルネーム
- 呼称バリエーション（別名・あだ名・略称）

### 2.2 出演社長セット
各動画において出演している社長の組合せ（原則5名）。動画ごとに管理し、コメント解析・集計はこの出演社長のみに対して行う。

### 2.3 言及コメント
コメントテキスト内で、特定の社長に言及していると判定されたコメント。1コメントが複数の社長に対して言及している場合は、各社長に対してカウントする（多対多）。

---

## 3. 指標定義

動画ごと、社長ごとに以下の指標を算出する。

### 3.1 基本カウント
- **N_total(video)**: 動画の総コメント数
- **N_entity(video)**: 出演社長のうち、誰かしらに言及しているコメント数
- **N_tiger(video, tiger)**: 動画内で、特定社長に言及しているコメント数

### 3.2 指標①：全コメント母数のパーセント（絶対的存在感）
- **定義**: Rate_total = N_tiger / N_total
- **用途**: 動画全体の中で、その社長がどれだけ視聴者の意識を占有したかを測る

### 3.3 指標②：言及コメント母数のパーセント（相対的主役度）
- **定義**: Rate_entity = N_tiger / N_entity
- **用途**: 「誰かしらの社長が話題に上がったコメント」の中で、どの社長がどれだけ話題の中心かを測る

### 3.4 補助指標（将来検討）
- コメント投稿時間分布
- 高評価コメント率
- 社長間の共起率
- トレンド指標（時系列での言及数推移）

---

## 4. システム概要

### 4.1 システムの流れ
本システムは以下の5つのフェーズで動作します：

```
【収集】→【前処理】→【解析】→【集計】→【表示】
```

1. **収集フェーズ**: YouTube APIで動画とコメントを取得
2. **前処理フェーズ**: コメントテキストを正規化（全角・半角統一など）
3. **解析フェーズ**: 社長の呼称辞書を使ってコメント内の言及を判定
4. **集計フェーズ**: 各指標（Rate_total, Rate_entity）を計算
5. **表示フェーズ**: Web UIで結果を可視化、CSVエクスポート

### 4.2 技術スタック
- **バックエンド**: Python 3.11+
- **データベース**: PostgreSQL（または小規模時はSQLite）
- **APIクライアント**: YouTube Data API v3
- **テキスト処理**: 文字正規化、正規表現マッチング
- **LLM（オプション）**: OpenAI/Claude API（文脈判定補助用）
- **Webフレームワーク**: FastAPI/Flask
- **フロントエンド**: Streamlit（簡易）またはReact（本格）
- **デプロイ**: Docker、AWS/Google Cloud

---

## 5. 機能要件

### 5.1 コメント収集機能
**機能概要**: YouTube APIを使用して、指定されたチャンネルの動画とコメントを収集する。

**主な処理**:
- チャンネルIDと期間を指定して動画一覧を取得
- 各動画のコメントを取得（トップレベルコメントのみ）
- 動画情報（タイトル、公開日、再生数、コメント数など）を保存
- エラー時は詳細ログを記録し、管理者に通知

### 5.2 社長マスタ管理機能
**機能概要**: 出演社長の情報と、その呼称バリエーション（別名辞書）を管理する。

**主な管理項目**:
- **社長マスタ**: 社長ID、表示名、本名、プロフィール画像、説明文
- **呼称・別名辞書**: 各社長の呼ばれ方（例：「林社長」「林さん」「FCの林」など）
  - エイリアスタイプ: 完全呼称/短縮形/あだ名/文脈依存
  - 優先度設定: マッチング時の優先順位
- **動画ごとの出演社長設定**: どの動画にどの社長が出演しているかを登録

**運用フロー例**:
1. 新規動画取得
2. 管理者が動画タイトル・サムネイルを確認
3. 出演社長5名を選択して登録
4. コメント解析を実行

### 5.3 コメント解析（社長言及判定）機能
**機能概要**: コメントから社長への言及を自動判定する。

**処理の流れ**:
1. **前処理**: コメントテキストの正規化（全角・半角統一、空白整理など）
2. **ルールベースマッチング**:
   - 出演社長の別名辞書を使用して文字列マッチング
   - 優先度順にエイリアスを試行
   - 複数社長への言及も検出（例：「林社長と岩井社長が面白い」）
   - 短縮形は文脈チェック（例：「林」単独ではマッチせず「林社長」でマッチ）
3. **AI補助判定（オプション）**:
   - ルールベースで判定できなかったコメントを対象
   - LLM APIに問い合わせて言及社長を判定
   - コスト管理のため月間上限を設定

### 5.4 集計・分析機能
**機能概要**: 言及判定結果から各指標を計算し、ランキングを生成する。

**主な集計内容**:
- **動画ごとの社長別集計**: N_total, N_entity, N_tiger, Rate_total, Rate_entity を計算
- **期間集計・ランキング**: 指定期間内の社長別累計言及数、平均指標、順位を算出
- **追加分析（将来）**: 時系列トレンド、社長間共起、センチメント分析など

### 5.5 表示・出力機能
**機能概要**: 集計結果をWeb UIで可視化し、データエクスポート機能を提供する。

**主な画面**:
- **動画一覧画面**: サムネイル、タイトル、コメント数、集計ステータスを一覧表示
- **動画詳細画面**:
  - 出演社長リスト
  - 集計結果表（社長別のN_tiger、Rate_total、Rate_entity、順位）
  - グラフ可視化（横棒グラフ、円グラフ）
  - コメントサンプル表示（上位10件）
- **社長一覧・管理画面**: 社長情報、エイリアス、統計情報の管理
- **ランキング画面**: 期間別の社長人気ランキング、時系列トレンドグラフ
- **システム設定画面**: APIキー設定、バッチスケジュール設定

**エクスポート機能**:
- CSV/Excel形式でデータをダウンロード
- 動画×社長集計結果、期間別ランキング、コメント詳細など

---

## 6. 非機能要件

### 6.1 精度要件
- **目標**: Precision ≥ 90%、Recall ≥ 80%、F1 Score ≥ 0.85
- **評価方法**: 300-500コメントを人手でラベリングし、システム判定と比較
- **定期評価**: 四半期ごとに実施、精度低下時は辞書メンテナンスまたはアルゴリズム改善

### 6.2 パフォーマンス要件
- **想定データ量**: 動画500本、コメント10万件（初期）
- **応答時間**: Web UIページ読み込み < 3秒、APIレスポンス < 2秒
- **バッチ処理時間**: 10動画（1万コメント）で < 30分

### 6.3 セキュリティ要件
- **認証・認可**: ユーザー ID/パスワード認証、ロールベースアクセス制御
- **データ保護**: APIキー・パスワードの暗号化管理、DB接続のSSL/TLS暗号化
- **脆弱性対策**: SQLインジェクション、XSS、CSRF対策
- **個人情報**: コメント投稿者のチャンネルIDは内部のみ使用、外部公開禁止

### 6.4 運用性
- **バックアップ**: 日次フルバックアップ、6時間ごと増分バックアップ
- **ログ管理**: 構造化ログ（JSON形式）、90日保管
- **モニタリング**: CPU/メモリ使用率、API応答時間、エラー率を監視
- **デプロイ**: Docker化、CI/CD（GitHub Actions）、ブルーグリーンデプロイ

### 6.5 法務・コンプライアンス
- **YouTube 利用規約**: 公式API使用、クォータ制限遵守（10,000 units/day）
- **個人情報保護**: 個人情報保護法準拠、データ最小化原則
- **著作権**: コメント本文引用は公開情報の範囲内、分析目的での使用

---

## 7. データベース設計

### 7.1 主要テーブル
本システムでは以下のテーブルでデータを管理します：

1. **videos**: 動画情報（video_id, title, published_at, view_count, comment_count など）
2. **comments**: コメント情報（comment_id, video_id, text_original, normalized_text, like_count など）
3. **tigers**: 社長マスタ（tiger_id, display_name, full_name, image_url, description など）
4. **tiger_aliases**: 社長別名辞書（alias_id, tiger_id, alias_text, alias_type, priority など）
5. **video_tigers**: 動画×社長 関連（video_id, tiger_id の組み合わせ）
6. **comment_tiger_relations**: コメント×社長 関連（comment_id, tiger_id, matched_alias, match_method など）
7. **video_tiger_stats**: 動画×社長 集計結果（video_id, tiger_id, N_total, N_entity, N_tiger, Rate_total, Rate_entity, rank など）
8. **users**: システムユーザー（管理画面用）
9. **batch_jobs**: バッチ処理履歴

---

## 8. ユースケース

### 8.1 主要ユーザーストーリー

**US-001: 動画コメント収集**
```
As a 管理者
I want to 特定期間の動画コメントを一括収集したい
So that 最新の視聴者反応をシステムに取り込める

受入基準:
- チャンネルIDと期間を指定できる
- YouTube API経由で動画とコメントを取得できる
- 取得状況をリアルタイムで確認できる
- エラー時は詳細なログが残る
```

**US-002: 社長言及分析**
```
As a 管理者
I want to コメントから社長言及を自動判定したい
So that 手作業なしで大量コメントを分析できる

受入基準:
- 出演社長リストに基づき判定される
- エイリアス辞書に基づくルールベースマッチングが動作する
- マッチ結果がDBに保存される
- 精度指標（Precision/Recall）が測定可能
```

**US-003: 動画別集計閲覧**
```
As a データアナリスト
I want to 各動画での社長別言及数と指標を確認したい
So that どの社長が話題になったか把握できる

受入基準:
- 動画詳細ページで集計結果が表形式で表示される
- Rate_total, Rate_entity が％表示される
- グラフで視覚的に比較できる
- コメントサンプルを閲覧できる
```

**US-004: 期間別ランキング確認**
```
As a 番組制作者
I want to 過去3ヶ月の社長人気ランキングを確認したい
So that 出演依頼の判断材料にできる

受入基準:
- 期間を柔軟に指定できる
- 社長別の総言及数、平均指標、出演動画数が表示される
- ランキング順位が自動計算される
- CSVエクスポート可能
```

---

## 9. テスト要件

### 9.1 テストレベル
- **単体テスト**: 各モジュール・関数、カバレッジ目標 ≥ 80%
- **統合テスト**: APIエンドポイント、バッチ処理フロー
- **E2Eテスト**: Web UIの主要フロー
- **パフォーマンステスト**: 10万コメントでの処理時間測定

### 9.2 主要テストケース
- コメント正規化（全角・半角混在 → 統一）
- エイリアスマッチング（完全呼称、短縮形、複数社長）
- 集計ロジック（N_total, N_tiger, Rate_total の計算）

---

## 10. 開発計画・フェーズ分け

### 10.1 MVP（2-3ヶ月）
**目標**: 基本機能の実装、小規模データでの動作検証

**スコープ**:
- YouTube API による動画・コメント収集
- ルールベースマッチング（LLM補助なし）
- 動画ごとの集計
- 簡易ダッシュボード（Streamlit）
- 社長マスタ・エイリアス管理

**成果物**: 動作するプロトタイプ、精度評価レポート

### 10.2 フェーズ2：機能拡張（1-2ヶ月）
- LLM補助判定の導入
- 期間集計・ランキング機能
- グラフ可視化の強化
- CSVエクスポート機能
- バッチ処理の自動化

### 10.3 フェーズ3：本番運用準備（1-2ヶ月）
- 本格的なWeb UI（React等）
- ユーザー認証・権限管理
- REST API 公開
- パフォーマンスチューニング
- 運用監視・アラート設定
- ドキュメント整備

### 10.4 フェーズ4：高度分析機能（将来）
- センチメント分析
- 時系列トレンド分析
- 社長間共起ネットワーク
- 機械学習モデルによる高度な判定

---

## 11. 制約・前提条件

- 各動画における出演社長5名の情報は、手動での登録または何らかの方法で事前に把握されている前提（自動抽出は範囲外）
- LLM等のAIサービス利用時には、別途APIキー・利用料金・レート制限を前提条件として考慮する
- MVP段階では以下をscope外とする：
  - ネガポジ判定（感情分析）
  - 社長以外の人物・企業・サービスなどの固有名詞分析
  - コメント返信ツリー構造の詳細分析
- システム利用者は日本語を理解し、YouTube動画を視聴可能な環境を持つ
- インターネット接続環境が必須（YouTube API アクセスのため）

---

## 12. 今後要検討事項

- 出演社長リストをどのタイミングで・誰が・どの粒度で管理するか（運用フロー詳細）
- LLM補助判定の導入タイミング → **推奨: フェーズ2**
- ダッシュボードのUI/UXをどこまで作り込むか → **MVP: 簡易、フェーズ3: 本格**
- どの指標を対外的な「公式指標」として打ち出すか → **推奨: 両方提示、用途に応じて使い分け**
- 動画タイトル・説明文からの出演社長自動推定の実現可能性
- 他チャンネル・他番組への横展開可能性
- データ分析結果の外部公開方針（ブログ記事、レポート等）

---

## 13. 参考資料

- YouTube Data API v3 ドキュメント: https://developers.google.com/youtube/v3
- YouTube API 利用規約: https://developers.google.com/youtube/terms/api-services-terms-of-service
- 個人情報保護法ガイドライン: https://www.ppc.go.jp/

---

**【改訂履歴】**
| バージョン | 日付 | 変更内容 | 作成者 |
|------------|------|----------|--------|
| 1.0 | YYYY-MM-DD | 初版作成 | - |
| 2.0 | 2025-11-13 | 簡略化：サービス概要重視、技術詳細削除 | Claude Code |
