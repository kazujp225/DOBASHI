# 令和の虎 社長別コメント言及分析システム

## プロジェクト概要

YouTube番組「令和の虎」の視聴者コメントを自動分析し、出演社長ごとの言及数・人気度を可視化するシステムです。

### 何ができるシステムか

- YouTube動画のコメントを自動収集
- 各社長（虎）への言及を自動判定
- 社長ごとの人気度・注目度を数値化
- 動画別・期間別のランキング生成
- Web UIでの可視化とCSVエクスポート

### なぜこのシステムが必要か

**現状の課題:**
- 視聴者がどの社長に注目しているかが定量的に把握できない
- 手動でコメントを集計するには膨大な時間がかかる（数千〜数万コメント）
- 出演者選定やマーケティング戦略の意思決定に客観的データがない

**このシステムで解決:**
- 自動分析により月次レポート作成時間を80%削減
- 社長別の定量データに基づく出演者選定が可能に
- 動画企画の反応傾向を数値で把握

---

## プロジェクト構成

```
DOBASHIYOUTUBE/
├── claude.md              # このファイル（プロジェクト概要）
├── plan.md               # 詳細要件定義書
├── src/                  # ソースコード（予定）
│   ├── collectors/       # YouTube API コメント収集
│   ├── analyzers/        # コメント解析・言及判定
│   ├── aggregators/      # 集計処理
│   ├── api/             # REST API
│   └── ui/              # Web UI
├── data/                # データファイル（予定）
│   ├── tigers.json      # 社長マスタ
│   └── aliases.json     # 呼称辞書
├── tests/               # テストコード（予定）
└── docker/              # Docker設定（予定）
```

---

## 主要な概念

### 1. 社長（虎）
番組に出演する投資家・社長のこと。システムでは以下を管理：
- 社長ID、表示名、本名
- 呼称バリエーション（「林社長」「林さん」「FCの林」など）

### 2. 言及判定
コメント内で特定の社長について言及しているかを判定する処理。

**例:**
- 「林社長すごい！」 → 林社長に言及
- 「林社長と岩井社長の対決が面白い」 → 両方に言及
- 「面白かった」 → 言及なし

### 3. 主要指標

#### Rate_total（絶対的存在感）
= 社長言及コメント数 / 動画の総コメント数

**意味:** 動画全体で、その社長がどれだけ視聴者の意識を占有したか

**例:** 動画に1000コメント、林社長言及が150件 → Rate_total = 15%

#### Rate_entity（相対的主役度）
= 社長言及コメント数 / 社長に関するコメント数

**意味:** 社長が話題になったコメントの中で、その社長がどれだけ話題の中心か

**例:** 社長関連コメント500件、林社長言及が150件 → Rate_entity = 30%

---

## システムの動作フロー

```
1. 【収集】YouTube API で動画とコメントを取得
     ↓
2. 【前処理】コメントテキストを正規化（全角・半角統一など）
     ↓
3. 【解析】社長の呼称辞書を使って言及を判定
     ↓
4. 【集計】各指標（Rate_total, Rate_entity）を計算
     ↓
5. 【表示】Web UI で結果を可視化、CSVエクスポート
```

### 詳細な処理内容

#### 収集フェーズ
- チャンネルIDと期間を指定
- YouTube Data API v3 で動画一覧とコメントを取得
- データベースに保存

#### 前処理フェーズ
- 全角・半角の統一（NFKC正規化）
- 空白・改行の整理
- HTMLタグの除去

#### 解析フェーズ
- **ルールベースマッチング**: 社長の別名辞書を使用して文字列マッチング
  - 優先度順にエイリアスを試行
  - 短縮形は文脈チェック（「林」単独は×、「林社長」は○）
  - 複数社長への同時言及も検出
- **AI補助判定（オプション）**: ルールで判定できないコメントはLLM APIで判定

#### 集計フェーズ
- 動画ごとに社長別の言及数をカウント
- Rate_total, Rate_entity を計算
- 動画内順位を算出

#### 表示フェーズ
- Web UIで動画一覧・詳細画面を表示
- グラフ可視化（横棒グラフ、円グラフ）
- 期間別ランキング生成
- CSV/Excelエクスポート

---

## 技術スタック

- **バックエンド**: Python 3.11+
- **データベース**: PostgreSQL（または小規模時はSQLite）
- **YouTube API**: YouTube Data API v3
- **テキスト処理**: 正規表現マッチング、文字正規化
- **LLM（オプション）**: OpenAI/Claude API
- **Webフレームワーク**: FastAPI または Flask
- **フロントエンド**: Streamlit（簡易）または React（本格）
- **デプロイ**: Docker、AWS/Google Cloud

---

## 開発フェーズ

### MVP（2-3ヶ月）
- YouTube API による動画・コメント収集
- ルールベースマッチング
- 動画ごとの集計
- 簡易ダッシュボード（Streamlit）
- 社長マスタ・エイリアス管理

### フェーズ2（1-2ヶ月）
- LLM補助判定の導入
- 期間集計・ランキング機能
- グラフ可視化の強化
- CSVエクスポート
- バッチ処理の自動化

### フェーズ3（1-2ヶ月）
- 本格的なWeb UI（React等）
- ユーザー認証・権限管理
- REST API 公開
- パフォーマンスチューニング
- 運用監視・アラート

### フェーズ4（将来）
- センチメント分析
- 時系列トレンド分析
- 社長間共起ネットワーク
- 機械学習モデルによる高度な判定

---

## 主要ユースケース

### 管理者の場合
1. チャンネルIDと期間を指定してコメント収集
2. 動画ごとに出演社長5名を登録
3. コメント解析を実行
4. 集計結果を確認
5. 必要に応じてエイリアス辞書をメンテナンス

### データアナリストの場合
1. 動画一覧から気になる動画を選択
2. 動画詳細画面で社長別集計結果を確認
3. グラフで視覚的に比較
4. CSVエクスポートして詳細分析

### 番組制作者の場合
1. ランキング画面で期間を指定（例：過去3ヶ月）
2. 社長別人気ランキングを確認
3. トレンドグラフで推移を把握
4. 出演依頼の判断材料として活用

---

## データベース構造

### 主要テーブル

1. **videos**: 動画情報（ID、タイトル、公開日、再生数など）
2. **comments**: コメント情報（ID、動画ID、本文、正規化済みテキスト、いいね数など）
3. **tigers**: 社長マスタ（ID、表示名、本名、画像URL、説明文など）
4. **tiger_aliases**: 社長別名辞書（ID、社長ID、別名、タイプ、優先度など）
5. **video_tigers**: 動画×社長 関連（どの動画にどの社長が出演しているか）
6. **comment_tiger_relations**: コメント×社長 関連（どのコメントがどの社長に言及しているか）
7. **video_tiger_stats**: 動画×社長 集計結果（N_total, N_tiger, Rate_total, Rate_entity, 順位など）

---

## 成功基準（KPI）

### システム精度
- **Precision（適合率）**: ≥ 90%
  - 「言及あり」と判定したコメントのうち、実際に言及しているものの割合
- **Recall（再現率）**: ≥ 80%
  - 実際に言及しているコメントのうち、システムが検出できた割合

### システム稼働
- データ収集〜集計完了: 10動画あたり30分以内
- Web UIページ読み込み: 3秒以内
- システム可用性: ≥ 95%（営業時間内）

### ビジネス価値
- 月次レポート作成時間を手動集計比で80%削減
- 社長別人気傾向の可視化により、出演者選定の意思決定支援を実現

---

## 制約・前提条件

- 各動画における出演社長5名の情報は手動登録が必要（自動抽出は範囲外）
- YouTube Data API のクォータ制限: 10,000 units/day
- LLM API使用時は月間上限とコストを管理
- MVP段階では以下をscope外:
  - センチメント分析（ネガポジ判定）
  - 社長以外の固有名詞分析
  - コメント返信ツリー構造の詳細分析

---

## セキュリティ・コンプライアンス

### YouTube 利用規約
- 公式API使用、スクレイピング禁止
- クォータ制限遵守
- データキャッシュは30日以内に更新

### 個人情報保護
- コメント投稿者のチャンネルIDは内部のみ使用、外部公開禁止
- 個人情報保護法準拠
- データ最小化原則

### セキュリティ対策
- APIキー・パスワードの暗号化管理
- SQLインジェクション、XSS、CSRF対策
- ユーザー認証・ロールベースアクセス制御

---

## 次のステップ

### 1. 環境セットアップ
- Python 3.11+ インストール
- PostgreSQL セットアップ
- YouTube Data API キー取得

### 2. 初期データ準備
- 社長マスタの作成（tigers.json）
- 呼称辞書の作成（aliases.json）

### 3. MVP開発開始
- コメント収集機能の実装
- ルールベースマッチングの実装
- 簡易ダッシュボードの構築

---

## 関連ドキュメント

- **plan.md**: 詳細要件定義書（本ドキュメントより詳細な技術仕様）
- YouTube Data API v3 ドキュメント: https://developers.google.com/youtube/v3
- YouTube API 利用規約: https://developers.google.com/youtube/terms/api-services-terms-of-service

---

## 更新履歴

| 日付 | 変更内容 | 作成者 |
|------|----------|--------|
| 2025-11-13 | 初版作成 | Claude Code |
